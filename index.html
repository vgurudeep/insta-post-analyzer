<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My IG Library</title>
    <style>
      :root {
        --bg-color: #000000;
        --card-bg: #121212;
        --text-primary: #ffffff;
        --text-secondary: #a8a8a8;
        --accent: #0095f6;
        --border: #262626;
      }

      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-primary);
        display: flex;
        height: 100vh;
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        border-right: 1px solid var(--border);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow-y: auto;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        font-family: "Cookie", cursive; /* Fallback for IG style font */
      }

      .filter-btn {
        background: transparent;
        border: none;
        color: var(--text-secondary);
        text-align: left;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
      }

      .filter-btn:hover {
        background-color: #1a1a1a;
        color: var(--text-primary);
      }

      .filter-btn.active {
        background-color: var(--card-bg);
        color: var(--text-primary);
        font-weight: 600;
        border-left: 3px solid var(--accent);
      }

      .count-badge {
        font-size: 12px;
        background: #333;
        padding: 2px 6px;
        border-radius: 10px;
      }

      /* Main Grid */
      .main-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
      }

      .card {
        background-color: var(--card-bg);
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
        transition: transform 0.2s;
      }

      .card:hover {
        transform: translateY(-2px);
        border-color: #444;
      }

      .card-img-container {
        width: 100%;
        padding-top: 100%; /* 1:1 Aspect Ratio */
        position: relative;
        background-color: #222;
      }

      .card-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .card-info {
        padding: 12px;
      }

      .card-cat {
        font-size: 11px;
        text-transform: uppercase;
        color: var(--accent);
        letter-spacing: 0.5px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .card-caption {
        font-size: 13px;
        color: var(--text-secondary);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin-bottom: 10px;
        line-height: 1.4;
      }

      .card-link {
        display: block;
        text-align: center;
        background: #333;
        color: white;
        text-decoration: none;
        padding: 8px;
        border-radius: 4px;
        font-size: 13px;
        font-weight: 600;
      }

      .card-link:hover {
        background: #444;
      }

      .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 50px;
        color: var(--text-secondary);
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="logo">IG Library</div>
      <button class="filter-btn active" onclick="filterData('All')">
        All Posts <span class="count-badge" id="count-all">0</span>
      </button>
      <div id="category-list">
        <!-- Categories injected here -->
      </div>
    </div>

    <div class="main-content">
      <div class="grid" id="grid">
        <!-- Cards injected here -->
      </div>
    </div>

    <!-- Import the data generated by Python -->
    <script src="data.js"></script>

    <script>
      // Check if data loaded
      if (typeof window.IG_DATA === "undefined") {
        document.getElementById("grid").innerHTML =
          '<div class="empty-state">Error: data.js not found. Run the Python script first!</div>';
      } else {
        initApp();
      }

      function initApp() {
        const data = window.IG_DATA;
        const categoryList = document.getElementById("category-list");
        const grid = document.getElementById("grid");

        // 1. Calculate Categories
        const categories = {};
        data.forEach((item) => {
          categories[item.category] = (categories[item.category] || 0) + 1;
        });

        // 2. Render Sidebar
        document.getElementById("count-all").innerText = data.length;

        Object.keys(categories)
          .sort()
          .forEach((cat) => {
            const btn = document.createElement("button");
            btn.className = "filter-btn";
            btn.innerHTML = `${cat} <span class="count-badge">${categories[cat]}</span>`;
            btn.onclick = () => filterData(cat, btn);
            categoryList.appendChild(btn);
          });

        // 3. Render Initial Grid
        renderGrid(data);
      }

      function filterData(category, clickedBtn) {
        const data = window.IG_DATA;

        // Update Active Button
        document
          .querySelectorAll(".filter-btn")
          .forEach((b) => b.classList.remove("active"));
        if (clickedBtn) {
          clickedBtn.classList.add("active");
        } else {
          document.querySelector(".filter-btn").classList.add("active"); // Select 'All'
        }

        // Filter
        if (category === "All") {
          renderGrid(data);
        } else {
          const filtered = data.filter((item) => item.category === category);
          renderGrid(filtered);
        }
      }

      function renderGrid(items) {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";

        if (items.length === 0) {
          grid.innerHTML =
            '<div class="empty-state">No posts found in this category.</div>';
          return;
        }

        items.forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
                    <div class="card-img-container">
                        <img src="${
                          item.image
                        }" class="card-img" loading="lazy" onerror="this.src='https://placehold.co/300x300?text=No+Image'">
                    </div>
                    <div class="card-info">
                        <div class="card-cat">${item.category}</div>
                        <div class="card-caption">${
                          item.caption || "No caption"
                        }</div>
                        <a href="${
                          item.link
                        }" target="_blank" class="card-link">View on Instagram</a>
                    </div>
                `;
          grid.appendChild(card);
        });
      }
    </script>
  </body>
</html>
