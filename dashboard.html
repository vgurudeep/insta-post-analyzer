<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG Interest Visualizer</title>
    <!-- Load ECharts from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            background: #1a1a1a;
            color: #fff;
            font-family: sans-serif;
            display: grid;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            overflow: hidden;
        }
        
        header {
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
        }

        h1 { font-size: 20px; margin: 0; }
        
        .tabs button {
            background: none;
            border: none;
            color: #888;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .tabs button.active {
            color: #0095f6;
            border-bottom: 2px solid #0095f6;
        }

        main {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .chart-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }

        .chart-container.active {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>

    <header>
        <h1>My Instagram DNA</h1>
        <div class="tabs">
            <button class="active" onclick="switchTab('bubble')">Bubble View</button>
            <button onclick="switchTab('network')">Network View</button>
        </div>
    </header>

    <main>
        <div id="bubbleChart" class="chart-container active"></div>
        <div id="networkChart" class="chart-container"></div>
    </main>

    <!-- Load the data -->
    <script src="viz_data.js"></script>

    <script>
        if (typeof window.VIZ_DATA === 'undefined') {
            alert("viz_data.js not found. Run analyze.py first!");
        }

        const data = window.VIZ_DATA;
        let bubbleChart, networkChart;

        // --- 1. Bubble Chart Configuration ---
        function initBubble() {
            bubbleChart = echarts.init(document.getElementById('bubbleChart'), 'dark');
            
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Interest Sizes', left: 'center', top: 20 },
                tooltip: {
                    formatter: function (info) {
                        return info.data.name + '<br>Posts: ' + info.data.value;
                    }
                },
                series: [
                    {
                        type: 'sunburst', // Sunburst works well for hierarchical bubble data
                        data: data.bubble.children,
                        radius: [0, '90%'],
                        label: {
                            rotate: 'radial'
                        },
                        itemStyle: {
                            borderRadius: 7,
                            borderWidth: 2
                        }
                    }
                ]
            };
            
            // Switch to a specialized Bubble Pack layout if preferred, 
            // but ECharts 'Sunburst' or 'TreeMap' is standard for hierarchical.
            // Let's use TreeMap for rectangle bubbles or Custom for circles.
            // Simpler approach for "Bubbles": Circle Packing using a simple Graph or TreeMap.
            // Let's stick to TreeMap for clarity of "Categories".
            
            const treeMapOption = {
                backgroundColor: '#1a1a1a',
                tooltip: { formatter: '{b}: {c} posts' },
                series: [{
                    type: 'treemap',
                    data: data.bubble.children,
                    leafDepth: 1, // Only show categories
                    roam: false,
                    itemStyle: {
                        borderColor: '#1a1a1a',
                        borderWidth: 2,
                        gapWidth: 2
                    },
                    levels: [
                        { itemStyle: { normal: { borderColor: '#555', borderWidth: 4, gapWidth: 4 } } },
                        { colorSaturation: [0.3, 0.6], itemStyle: { borderColorSaturation: 0.7, gapWidth: 2, borderWidth: 2 } }
                    ]
                }]
            };

            bubbleChart.setOption(treeMapOption);
        }

        // --- 2. Network Chart Configuration ---
        function initNetwork() {
            networkChart = echarts.init(document.getElementById('networkChart'), 'dark');
            
            const option = {
                backgroundColor: '#1a1a1a',
                title: { text: 'Topic Connections', left: 'center', top: 20 },
                tooltip: {},
                legend: [{
                    data: data.network.categories.map(function (a) { return a.name; })
                }],
                series: [
                    {
                        type: 'graph',
                        layout: 'force',
                        data: data.network.nodes,
                        links: data.network.links,
                        categories: data.network.categories,
                        roam: true,
                        label: {
                            show: true,
                            position: 'right',
                            formatter: '{b}'
                        },
                        labelLayout: {
                            hideOverlap: true
                        },
                        force: {
                            repulsion: 100,
                            edgeLength: 50
                        },
                        lineStyle: {
                            color: 'source',
                            curveness: 0.3
                        }
                    }
                ]
            };
            networkChart.setOption(option);
        }

        // --- Tabs Logic ---
        function switchTab(tab) {
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.chart-container').forEach(c => c.classList.remove('active'));
            
            if(tab === 'bubble') {
                document.getElementById('bubbleChart').classList.add('active');
                if(!bubbleChart) initBubble();
            } else {
                document.getElementById('networkChart').classList.add('active');
                if(!networkChart) initNetwork();
            }
        }

        // Init Default
        initBubble();

        // Resize handler
        window.addEventListener('resize', () => {
            bubbleChart && bubbleChart.resize();
            networkChart && networkChart.resize();
        });

    </script>
</body>
</html>